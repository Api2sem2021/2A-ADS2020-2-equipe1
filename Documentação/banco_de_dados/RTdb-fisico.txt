CREATE DATABASE rtracker;

CREATE TABLE funcionarios (
	nome VARCHAR(60) NOT NULL,
	cpf VARCHAR(11) UNIQUE NOT NULL PRIMARY KEY,
	senha VARCHAR(30) NOT NULL,
	cargo VARCHAR(30) NOT NULL
);


CREATE TABLE filiais (
	id_filial SERIAL UNIQUE NOT NULL PRIMARY KEY,
	nome_filial VARCHAR(30) NOT NULL,
	cidade_filial VARCHAR(30) NOT NULL,
	estado_fi VARCHAR(2) NOT NULL
);

CREATE TABLE status (
	id_status SERIAL NOT NULL PRIMARY KEY,
	cpf VARCHAR(11) NOT NULL,
	status_inicio TIME,
	status_fim TIME,
	status_total TIME,
	tipo_status VARCHAR (20),
	data_status DATE
);

CREATE TABLE motoristas (
	nome VARCHAR(60) NOT NULL,
	cpf VARCHAR(11) UNIQUE NOT NULL PRIMARY KEY,
	senha VARCHAR(11) NOT NULL,
	carga_horaria TIME,
	turno VARCHAR (10)
);

CREATE TABLE viagens (
	id_viagem serial UNIQUE NOT NULL PRIMARY KEY,
	destino VARCHAR (60) NOT NULL,
	viagem_inicio TIMESTAMP,
	viagem_fim TIMESTAMP,
	viagem_total TIMESTAMP
);

CREATE TABLE veiculos (
	id_rastreador VARCHAR (30) NOT NULL PRIMARY KEY,
	placa VARCHAR (8) NOT NULL,
	versao_rastreador VARCHAR (30),
	marca_rastreador VARCHAR (30)
);

ALTER TABLE funcionarios 
      ADD COLUMN fk_id_filial INTEGER, 
      ADD CONSTRAINT fk_id_filial
      FOREIGN KEY (fk_id_filial) 
      REFERENCES filiais(id_filial);

ALTER TABLE motoristas 
      ADD COLUMN fk_id_filial INTEGER, 
      ADD CONSTRAINT fk_id_filial
      FOREIGN KEY (fk_id_filial) 
      REFERENCES filiais(id_filial);

ALTER TABLE status 
      ADD COLUMN fk_motorista_cpf VARCHAR(11), 
      ADD CONSTRAINT fk_motorista_cpf
      FOREIGN KEY (fk_motorista_cpf) 
      REFERENCES motoristas(cpf);

ALTER TABLE status 
      ADD COLUMN fk_viagem_id INTEGER, 
      ADD CONSTRAINT fk_viagem_id
      FOREIGN KEY (fk_viagem_id) 
      REFERENCES viagens(id_viagem);

ALTER TABLE veiculos 
      ADD COLUMN fk_motorista_cpf VARCHAR(11), 
      ADD CONSTRAINT fk_motorista_cpf
      FOREIGN KEY (fk_motorista_cpf) 
      REFERENCES motoristas(cpf);

ALTER TABLE viagens
      ADD COLUMN fk_motorista_cpf VARCHAR(11), 
      ADD CONSTRAINT fk_motorista_cpf
      FOREIGN KEY (fk_motorista_cpf) 
      REFERENCES motoristas(cpf);


INSERT INTO funcionarios (nome, cpf, senha, cargo) VALUES ('root', '00000000000', 'root', 'adm');
INSERT INTO  motoristas (nome, cpf, senha, turno) VALUES ('motorista1', '22222222222', 'teste321', 'noturno');
INSERT INTO status (cpf, tipo_status) VALUES ('22222222222', 'refeição');

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<<testes>>
SELECT nome, cpf FROM motoristas where turno = 'noturno';
UPDATE motoristas SET senha = '123abc' WHERE senha = 'teste321';
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<< Não tenho certeza do valor que folga e dias_trabalho na tabela motoristas, então nao crie a tabela motoristas ainda>>